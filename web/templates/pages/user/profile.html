<div class="page-header">
    <h1>My Profile</h1>
</div>

{{if .Error}}
<div class="error-message">{{.Error}}</div>
{{end}}

{{if .Success}}
<div class="success-message">{{.Success}}</div>
{{end}}

<section class="section">
    <h2>Profile Picture</h2>
    <div class="avatar-section">
        <img src="{{.User.GetProfilePictureURL}}" alt="{{.User.DisplayName}}" class="avatar-large">
        <div class="avatar-actions">
            <form method="POST" action="/profile/avatar" enctype="multipart/form-data" class="avatar-upload-form">
                <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                <input type="file" name="avatar" id="avatar" accept="image/jpeg,image/png,image/gif,image/webp" required>
                <button type="submit" class="btn btn-primary">Upload</button>
            </form>
            {{if .User.HasProfilePicture}}
            <form method="POST" action="/profile/avatar/remove" class="avatar-remove-form">
                <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                <button type="submit" class="btn btn-danger">Remove</button>
            </form>
            {{end}}
            <p class="avatar-help">JPEG, PNG, GIF, or WebP. Max 2MB.</p>
        </div>
    </div>
</section>

<section class="section">
    <h2>Profile Theme</h2>
    <p class="avatar-help" style="margin-bottom: 1rem;">Choose a color theme for your public profile page.</p>
    <form method="POST" action="/profile/theme" class="form">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
        <div class="theme-selector">
            {{range $key, $name := .Themes}}
            <label class="theme-option" data-theme="{{$key}}">
                <input type="radio" name="theme" value="{{$key}}" {{if eq $.User.Theme $key}}checked{{end}}>
                <div class="theme-preview">
                    <div class="theme-preview-bg"></div>
                    <div class="theme-preview-surface"></div>
                </div>
                <span class="theme-name">{{$name}}</span>
            </label>
            {{end}}
        </div>
        <button type="submit" class="btn btn-primary" style="margin-top: 1rem;">Save Theme</button>
    </form>
</section>

<section class="section">
    <h2>Profile Information</h2>
    <div class="form-container">
        <form method="POST" action="/profile" class="form">
            <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
            <div class="form-group">
                <label for="username">Username (cannot be changed)</label>
                <input type="text" id="username" value="{{.User.Username}}" disabled>
            </div>
            <div class="form-group">
                <label for="display_name">Display Name</label>
                <input type="text" id="display_name" name="display_name" required value="{{.User.DisplayName}}">
            </div>
            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" rows="3">{{.User.Description}}</textarea>
            </div>
            <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
    </div>
</section>

<section class="section">
    <h2>Change Password</h2>
    <div class="form-container">
        <form method="POST" action="/profile/password" class="form">
            <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
            <div class="form-group">
                <label for="current_password">Current Password</label>
                <input type="password" id="current_password" name="current_password" required>
            </div>
            <div class="form-group">
                <label for="new_password">New Password</label>
                <input type="password" id="new_password" name="new_password" required minlength="8">
            </div>
            <div class="form-group">
                <label for="confirm_password">Confirm New Password</label>
                <input type="password" id="confirm_password" name="confirm_password" required minlength="8">
            </div>
            <button type="submit" class="btn btn-primary">Change Password</button>
        </form>
    </div>
</section>
