<div class="page-header">
    <h1>Add Books for {{.User.DisplayName}}</h1>
    <div class="page-header-actions">
        <a href="/admin/users/{{.User.ID}}/books" class="btn btn-secondary">Back to Books</a>
    </div>
</div>

<section class="section">
    <form method="GET" action="/admin/users/{{.User.ID}}/books/search" class="form form-inline search-form">
        <div class="form-group">
            <input type="text" name="q" value="{{.Query}}" placeholder="Search for books..." autofocus
                   hx-get="/admin/users/{{.User.ID}}/books/search"
                   hx-trigger="input changed delay:500ms, search"
                   hx-target="#search-results"
                   hx-indicator="#search-indicator">
        </div>
        <span id="search-indicator" class="htmx-indicator search-indicator">Searching...</span>
    </form>
</section>

<div id="search-results">
{{if .Error}}
<div class="error-message">{{.Error}}</div>
{{end}}

{{if .Results}}
<section class="section">
    <h2>Search Results</h2>
    <div class="search-results">
        {{range .Results}}
        <div class="search-result-item">
            {{if .GoogleBooksID}}
            <img src="/api/images/book/{{.GoogleBooksID}}" alt="{{.Title}}" class="book-thumb">
            {{else}}
            <div class="book-thumb-placeholder"></div>
            {{end}}
            <div class="book-details">
                <strong>{{.Title}}</strong>
                {{if .Authors}}<br><span class="authors">{{.Authors}}</span>{{end}}
            </div>
            <form method="POST" action="/admin/users/{{$.User.ID}}/books" class="add-book-form">
                <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
                <input type="hidden" name="google_books_id" value="{{.GoogleBooksID}}">
                <input type="hidden" name="title" value="{{.Title}}">
                <input type="hidden" name="authors" value="{{.Authors}}">
                <input type="hidden" name="thumbnail_url" value="{{.ThumbnailURL}}">
                <select name="shelf" required>
                    <option value="">Select shelf...</option>
                    <option value="want_to_read">Want to Read</option>
                    <option value="currently_reading">Currently Reading</option>
                    <option value="read">Read</option>
                </select>
                <button type="submit" class="btn btn-primary btn-small">Add</button>
            </form>
        </div>
        {{end}}
    </div>
</section>
{{else if .Query}}
<p class="empty-state">No results found for "{{.Query}}".</p>
{{end}}
</div>
